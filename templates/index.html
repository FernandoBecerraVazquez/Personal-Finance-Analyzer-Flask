<!DOCTYPE html>
<html>
<head>
    <title>Financial Transactions</title>
    <style>
        /* Estilos básicos para la tabla y el formulario */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        h1, h2 { color: #333; }
        .data { border-collapse: collapse; width: 100%; margin-top: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .data th, .data td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .data th { background-color: #e0e0e0; font-weight: bold; }
        .data tr:nth-child(even) { background-color: #f9f9f9; }
        .data tr:hover { background-color: #f1f1f1; }
        
        form { margin-bottom: 20px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="text"], input[type="number"], input[type="date"], select { 
            width: calc(100% - 22px); 
            padding: 10px; 
            margin-bottom: 15px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box; 
        }
        button { 
            padding: 10px 20px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px; 
            transition: background-color 0.3s ease;
        }
        button:hover { background-color: #45a049; }
        
        /* Estilos para mensajes flash */
        .flash-messages { list-style: none; padding: 0; margin-bottom: 20px; }
        .flash-message { 
            padding: 15px; 
            margin-bottom: 10px; 
            border-radius: 5px; 
            border: 1px solid transparent; 
            font-weight: bold;
        }
        .flash-message.error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .flash-message.success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
        .flash-message.info { background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; }

        /* Estilo para el botón de eliminar una sola transacción */
        .delete-single-button {
            background-color: #dc3545; /* Rojo más oscuro */
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em; /* Botón más pequeño */
            transition: background-color 0.3s ease;
        }
        .delete-single-button:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <h1>Financial Transactions</h1>

    {# Bloque para mostrar mensajes flash #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flash-messages">
        {% for category, message in messages %}
          <li class="flash-message {{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <h2>Add New Transaction</h2>
    <form action="/add_transaction" method="post">
        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required value="{{ today }}">

        <label for="description">Description:</label>
        <input type="text" id="description" name="description" required>

        <label for="type">Type:</label>
        <select id="type" name="type" required>
            <option value="Expense">Expense</option>
            <option value="Income">Income</option>
        </select>

        <label for="amount">Amount (EUR):</label>
        <input type="number" id="amount" name="amount" step="0.01" required>

        <button type="submit">Add Transaction</button>
    </form>

    <h2>All Transactions (Current Month)</h2>
    <table class="data">
        <thead>
            <tr>
                <th>ID</th> <th>Date</th>
                <th>Name / Description</th>
                <th>Expense/Income</th>
                <th>Amount (EUR)</th>
                <th>Actions</th> </tr>
        </thead>
        <tbody>
            {# Bucle para iterar sobre los datos de transacciones pasados desde Flask #}
            {% if transactions_data is not none and not transactions_data.empty %}
                {% for index, row in transactions_data.iterrows() %}
                <tr>
                    <td>{{ index }}</td> <td>{{ row['Date'].strftime('%Y-%m-%d') }}</td> {# Formatear la fecha para mostrar #}
                    <td>{{ row['Name / Description'] }}</td>
                    <td>{{ row['Expense/Income'] }}</td>
                    <td>{{ '%.2f' | format(row['Amount (EUR)']) }}</td> {# Formatear el monto a 2 decimales #}
                    <td>
                        <form action="/delete_transaction/{{ index }}" method="post" onsubmit="return confirm('¿Estás seguro de que quieres eliminar esta transacción? Esta acción no se puede deshacer.');">
                            <button type="submit" class="delete-single-button">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td colspan="9">No transactions for the current month.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <script>
        // No se necesita JavaScript adicional, el confirm está en el atributo onsubmit.
    </script>
</body>
</html>